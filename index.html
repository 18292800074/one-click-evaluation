<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä¼˜è´¨è¯„ä»·æ–‡æ¡ˆç”Ÿæˆå™¨</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; margin: 0; padding: 0; background: #f6f8fa; }
    .container { max-width: 720px; margin: 0 auto; padding: 24px 16px 48px; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.08); padding: 20px; }
    h1 { font-size: 20px; margin: 0 0 16px; }
    label { display: block; font-size: 14px; color: #555; margin: 12px 0 6px; }
    input[type="text"], textarea, select { width: 100%; box-sizing: border-box; padding: 10px 12px; border-radius: 8px; border: 1px solid #d0d7de; outline: none; font-size: 14px; background: #fff; }
    textarea { min-height: 96px; resize: vertical; }
    .row { display: flex; gap: 12px; align-items: center; }
    .row > * { flex: 1; }
    .actions { display: flex; gap: 12px; margin-top: 16px; }
    button { cursor: pointer; border: none; padding: 10px 14px; border-radius: 8px; font-size: 14px; }
    .btn-primary { background: #1677ff; color: #fff; }
    .btn-secondary { background: #eef2ff; color: #1f2937; }
    .result { margin-top: 16px; padding: 12px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; white-space: pre-wrap; word-break: break-word; font-size: 14px; }
    .tips { color: #6b7280; font-size: 12px; margin-top: 6px; }
    .muted { color: #64748b; font-size: 12px; }
    .footer { text-align: center; color: #94a3b8; font-size: 12px; margin-top: 16px; }
  </style>
  <meta name="referrer" content="no-referrer">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>åº—é“ºè·³è½¬æµ‹è¯•å·¥å…·</h1>
      <div class="tips" style="margin-bottom: 16px; padding: 8px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px;">
        ğŸ“± æµ‹è¯•ç¾å›¢/æŠ–éŸ³åº—é“ºè·³è½¬åŠŸèƒ½ï¼Œç›´æ¥åœ¨æ‰‹æœºä¸Šå®æ—¶æµ‹è¯•ï¼
      </div>

      <label for="shopPlatform">é€‰æ‹©å¹³å°</label>
      <select id="shopPlatform">
        <option value="douyin">æŠ–éŸ³åº—é“º</option>
        <option value="meituan">ç¾å›¢åº—é“º</option>
      </select>

      <div class="actions">
        <button id="btnTest1" class="btn-primary">æµ‹è¯•1: æ™ºèƒ½è·³è½¬</button>
        <button id="btnTest2" class="btn-primary">æµ‹è¯•2: APPæ£€æµ‹è·³è½¬</button>
        <button id="btnTest3" class="btn-primary">æµ‹è¯•3: ç½‘é¡µç‰ˆé“¾æ¥</button>
        <button id="btnTest4" class="btn-primary">æµ‹è¯•4: å¤åˆ¶é“¾æ¥</button>
        <button id="btnTest5" class="btn-primary">æµ‹è¯•5: æŠ–éŸ³é“¾æ¥</button>
      </div>

      <div id="status" class="muted" style="margin-top:8px;"></div>
    </div>
    <div class="footer">åº—é“ºè·³è½¬æµ‹è¯•å·¥å…· - æ”¯æŒç¾å›¢/æŠ–éŸ³åº—é“ºè·³è½¬</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const btnTest1 = $("btnTest1");
    const btnTest2 = $("btnTest2");
    const btnTest3 = $("btnTest3");
    const btnTest4 = $("btnTest4");
    const btnTest5 = $("btnTest5");
    const status = $("status");
    
    // å¹³å°åœ°å€é…ç½®
    const PLATFORM_URLS = {
      douyin: "https://v.douyin.com/J5Qzqzvyb8Y/",
      meituan: "https://g.meituan.com/gfe/mmp-gc-poidetail/detail-page/detail?shopid=1033453100&utm_term=AandroidBgroupC12.44.203DweiboEpoiG2025101117141800000000000009052C1B83FF245D38601621B9373465CA165714723951899722153&lch=appshare_4a810e513fbc3171A5&utm_fromapp=copy&utm_medium=androidweb&userId=265394714&ticket_exchange_for_token=at%3AC5148CBE67C8533F2B1B2E5279AC1753%3AAQD6G1LqAAAAADAAAAC84csgc2EWnVZvtuvzAlnMnJ3PFsfx1OLg3uXREc-CX_AneucCWvzR5MYIgdHPSAe8Zdj0oWpqtUqwkxGcYWsg1S_rZw&utm_source=appshare&poiIdEncrypt=qB4r17787ba40abd9fe260a337935d72610ee8e63d7690a06106e1ce2a76ee7e798f8d2f49edd8a2b8b73625236509e42666b45860vxu5"
    };
    
    // ç¾å›¢åº—é“ºä¿¡æ¯
    const MEITUAN_SHOP_INFO = {
      name: "æå°å¯»é€ å‹ï¼ˆé™…åå¹¿åœºåº—ï¼‰",
      address: "é›å¡”åŒºæ˜†æ˜æ± è·¯é‡‘è¾‰æ‚¦åºœå°åŒ—é—¨é—¨å£",
      phone: "17602910667",
      url: "http://dpurl.cn/ipWBl40z"
    };
    
    // ç¾å›¢APPæ·±åº¦é“¾æ¥é…ç½®
    const MEITUAN_APP_SCHEME = "imeituan://www.meituan.com/";
    const MEITUAN_SHOP_DEEP_LINK = "imeituan://www.meituan.com/shop/";
    const MEITUAN_FALLBACK_URL = "http://dpurl.cn/ipWBl40z";
    
    // DeepSeek é…ç½®ï¼ˆå·²æ³¨é‡Šæ‰ï¼Œä¸å†ä½¿ç”¨ç”Ÿæˆæ–‡æ¡ˆåŠŸèƒ½ï¼‰
    /*
    const DEEPSEEK_CONFIG = {
      apiBase: "https://api.deepseek.com/v1",
      apiKey: "sk-33d4ff5bcb004f26a62cd6f17df25a78",
      model: "deepseek-chat"
    };
    */

    // ç”Ÿæˆæ–‡æ¡ˆç›¸å…³å‡½æ•°å·²æ³¨é‡Šæ‰
    /*
    function cutToLength(text, len) {
      if (!text) return "";
      const t = text.replace(/\s+/g, "");
      if (t.length <= len) return t;
      // ä¿ç•™è¯­ä¹‰ï¼Œå°½é‡åœ¨å¥å·/é¡¿å·å¤„æˆªæ–­
      const slice = t.slice(0, len + 4);
      const pivot = Math.max(slice.lastIndexOf("ã€‚"), slice.lastIndexOf("ï¼"), slice.lastIndexOf("ï¼›"), slice.lastIndexOf("ï¼Œ"));
      return (pivot > len - 20 ? slice.slice(0, pivot + 1) : t.slice(0, len)).trim();
    }

    async function callChatCompletions({ apiBase, apiKey, model, system, user, temperature = 0.7, maxTokens = 300 }) {
      const url = apiBase.replace(/\/$/, "") + "/chat/completions";
      const resp = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + apiKey
        },
        body: JSON.stringify({
          model,
          messages: [
            { role: "system", content: system },
            { role: "user", content: user }
          ],
          temperature,
          max_tokens: maxTokens
        })
      });
      if (!resp.ok) {
        let text = await resp.text().catch(() => "");
        throw new Error(`HTTP ${resp.status}: ${text}`);
      }
      const data = await resp.json();
      const content = data?.choices?.[0]?.message?.content || "";
      return content.trim();
    }

    async function generate() {
      // ä½¿ç”¨é»˜è®¤æç¤ºè¯ï¼Œå› ä¸ºè¾“å…¥æ¡†å·²éšè—
      const prompt = "æŠ€æœ¯ä¸“ä¸šã€æœåŠ¡è´´å¿ƒã€ç¯å¢ƒèˆ’é€‚ã€ä»·æ ¼åˆç†ã€æ•ˆæœæ»¡æ„ï¼Œé€‚åˆå„ç§å‘è´¨å’Œè„¸å‹";
      
      // è·å–é€‰ä¸­çš„ç±»ç›®
      const checkedCategories = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .map(cb => cb.value);
      const category = checkedCategories.length > 0 ? checkedCategories.join('ã€') : "ç¾å‘æœåŠ¡";
      
      // è·å–é€‰ä¸­çš„æœåŠ¡äººå‘˜
      const checkedStaff = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .filter(cb => ['è–‡è–‡è€å¸ˆ', 'èµµè€å¸ˆ', 'æè€å¸ˆ', 'æ´‹å­è€å¸ˆ', 'å°æ°'].includes(cb.value))
        .map(cb => cb.value);
      const staff = checkedStaff.length > 0 ? checkedStaff.join('ã€') : "";
      
      // å†…ç½®100-240å­—éšæœº
      const targetLength = Math.floor(Math.random() * 141) + 100; // 100-240éšæœº
      
      btnGen.disabled = true; btnGen.textContent = "ç”Ÿæˆä¸­â€¦"; status.textContent = "";
      try {
        const system = "ä½ æ˜¯ä¸€ä¸ªçœŸå®çš„ç”¨æˆ·ï¼Œæ­£åœ¨ç»™ç¾å‘åº—å†™è¯„ä»·ã€‚è¯·ç”¨è‡ªç„¶ã€çœŸå®çš„è¯­è¨€ï¼Œåƒæ™®é€šæ¶ˆè´¹è€…ä¸€æ ·è¡¨è¾¾è‡ªå·±çš„ä½¿ç”¨æ„Ÿå—ã€‚é¿å…å®˜æ–¹è¯æœ¯ã€è¥é”€è¯æ±‡ï¼Œè¦åƒæœ‹å‹èŠå¤©ä¸€æ ·è‡ªç„¶ã€‚å¯ä»¥åŒ…å«ä¸ªäººä½“éªŒç»†èŠ‚ã€å¯¹æ¯”æ„Ÿå—ã€ä½¿ç”¨åœºæ™¯ç­‰çœŸå®å†…å®¹ã€‚";
        let userMsg = `è¯·å¸®æˆ‘å†™ä¸€ä¸ªå…³äº${category}çš„çœŸå®ç”¨æˆ·è¯„ä»·ï¼Œå¤§çº¦${targetLength}å­—å·¦å³ã€‚`;
        if (staff) {
          userMsg += `æœåŠ¡äººå‘˜æ˜¯${staff}ã€‚`;
        }
        userMsg += `åŸºäºä»¥ä¸‹è¦ç‚¹ï¼š${prompt}\n\nè¦æ±‚ï¼š1.è¯­è¨€è‡ªç„¶çœŸå®ï¼ŒåƒçœŸäººå†™çš„ 2.é¿å…"éå¸¸å¥½"ã€"å¼ºçƒˆæ¨è"ç­‰å¥—è¯ 3.å¯ä»¥åŒ…å«å…·ä½“çš„ä½¿ç”¨ç»†èŠ‚å’ŒæœåŠ¡äººå‘˜ 4.å­—æ•°æ§åˆ¶åœ¨${targetLength}å­—å·¦å³ 5.ä¸è¦åŠ å¼•å·æˆ–è¡¨æƒ…ç¬¦å·`;
        const raw = await callChatCompletions({ 
          apiBase: DEEPSEEK_CONFIG.apiBase, 
          apiKey: DEEPSEEK_CONFIG.apiKey, 
          model: DEEPSEEK_CONFIG.model, 
          system, 
          user: userMsg, 
          temperature: 0.8, 
          maxTokens: 400 
        });
        const text = cutToLength(raw, targetLength);
        result.style.display = "block";
        result.textContent = text;
        btnCopyGo.disabled = !text;
        const actualLength = text.replace(/\s+/g, "").length;
        status.textContent = text ? `å·²ç”ŸæˆçœŸå®è¯„ä»·ï¼Œå…±${actualLength}å­—` : "ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•";
      } catch (e) {
        status.textContent = "è¯·æ±‚å¤±è´¥ï¼š" + (e && e.message ? e.message : e);
      } finally {
        btnGen.disabled = false; btnGen.textContent = "ç”Ÿæˆæ–‡æ¡ˆ";
      }
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (_) {}
      // æ—§æ–¹æ¡ˆå…œåº•
      const ta = document.createElement("textarea");
      ta.value = text; document.body.appendChild(ta);
      ta.select(); ta.setSelectionRange(0, 99999);
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }
    */

    // btnGen.addEventListener("click", generate); // æš‚æ—¶æ³¨é‡Šæ‰ç”Ÿæˆæ–‡æ¡ˆåŠŸèƒ½
    
    // æµ‹è¯•1: æ™ºèƒ½è·³è½¬
    function testSmartJump() {
      const shopInfo = MEITUAN_SHOP_INFO;
      const shopDetails = `åº—é“ºåç§°ï¼š${shopInfo.name}\nåº—é“ºåœ°å€ï¼š${shopInfo.address}\nè”ç³»ç”µè¯ï¼š${shopInfo.phone}`;
      
      console.log('æµ‹è¯•1: æ™ºèƒ½è·³è½¬');
      status.textContent = `æµ‹è¯•1: æ™ºèƒ½è·³è½¬\n\n${shopDetails}\n\nå°è¯•å¤šç§è·³è½¬æ–¹å¼...`;
      
      try {
        // ç­–ç•¥1: å°è¯•ç¾å›¢APPæ·±åº¦é“¾æ¥
        const shopId = "1033453100";
        const appLinks = [
          `imeituan://www.meituan.com/meishi/${shopId}/`,
          `imeituan://www.meituan.com/shop/${shopId}/`,
          `imeituan://www.meituan.com/meishi/?shopid=${shopId}`,
          "imeituan://www.meituan.com/"
        ];
        
        // å°è¯•ç¬¬ä¸€ä¸ªæ·±åº¦é“¾æ¥
        const linkElement = document.createElement('a');
        linkElement.href = appLinks[0];
        linkElement.style.display = 'none';
        document.body.appendChild(linkElement);
        linkElement.click();
        document.body.removeChild(linkElement);
        
        status.textContent = `æµ‹è¯•1: APPè·³è½¬å°è¯•ä¸­...\n\n${shopDetails}\n\nå¦‚æœAPPæœªæ‰“å¼€ï¼Œå°†ä½¿ç”¨ç½‘é¡µç‰ˆ`;
        
        // ç­–ç•¥2: å¤‡ç”¨ç½‘é¡µç‰ˆ
        setTimeout(() => {
          const webUrl = PLATFORM_URLS.meituan;
          window.open(webUrl, '_blank');
          status.textContent = `æµ‹è¯•1å®Œæˆï¼\n\n${shopDetails}\n\nå·²å°è¯•APPè·³è½¬ï¼Œå¹¶æ‰“å¼€ç½‘é¡µç‰ˆä½œä¸ºå¤‡ç”¨`;
        }, 2000);
        
      } catch (e) {
        console.log('æµ‹è¯•1å¤±è´¥:', e);
        status.textContent = `æµ‹è¯•1å¤±è´¥ï¼š${e.message}`;
      }
    }
    
    // æµ‹è¯•2: APPæ£€æµ‹è·³è½¬
    function testAppDetectionJump() {
      const shopInfo = MEITUAN_SHOP_INFO;
      const shopDetails = `åº—é“ºåç§°ï¼š${shopInfo.name}\nåº—é“ºåœ°å€ï¼š${shopInfo.address}\nè”ç³»ç”µè¯ï¼š${shopInfo.phone}`;
      
      console.log('æµ‹è¯•2: APPæ£€æµ‹è·³è½¬');
      status.textContent = `æµ‹è¯•2: APPæ£€æµ‹è·³è½¬\n\n${shopDetails}\n\næ£€æµ‹ç¾å›¢APPæ˜¯å¦å®‰è£…...`;
      
      try {
        // æ£€æµ‹APPæ˜¯å¦å®‰è£…çš„æ–¹æ³•
        const shopId = "1033453100";
        const appLink = `imeituan://www.meituan.com/meishi/${shopId}/`;
        const webLink = PLATFORM_URLS.meituan;
        
        // åˆ›å»ºéšè—çš„iframeæ¥æ£€æµ‹APP
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = appLink;
        document.body.appendChild(iframe);
        
        // è®¾ç½®è¶…æ—¶æ£€æµ‹
        let appOpened = false;
        const timeout = setTimeout(() => {
          if (!appOpened) {
            // APPæœªæ‰“å¼€ï¼Œä½¿ç”¨ç½‘é¡µç‰ˆ
            window.open(webLink, '_blank');
            status.textContent = `æµ‹è¯•2å®Œæˆï¼\n\n${shopDetails}\n\nAPPæ£€æµ‹è¶…æ—¶ï¼Œå·²æ‰“å¼€ç½‘é¡µç‰ˆ`;
          }
          document.body.removeChild(iframe);
        }, 3000);
        
        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆAPPæ‰“å¼€æ—¶é¡µé¢ä¼šå¤±å»ç„¦ç‚¹ï¼‰
        const handleVisibilityChange = () => {
          if (document.hidden) {
            appOpened = true;
            clearTimeout(timeout);
            status.textContent = `æµ‹è¯•2å®Œæˆï¼\n\n${shopDetails}\n\næ£€æµ‹åˆ°ç¾å›¢APPå·²æ‰“å¼€`;
            document.removeEventListener('visibilitychange', handleVisibilityChange);
          }
        };
        
        document.addEventListener('visibilitychange', handleVisibilityChange);
        
      } catch (e) {
        console.log('æµ‹è¯•2å¤±è´¥:', e);
        status.textContent = `æµ‹è¯•2å¤±è´¥ï¼š${e.message}`;
      }
    }
    
    // æµ‹è¯•3: ç½‘é¡µç‰ˆé“¾æ¥
    function testWebLink() {
      const shopInfo = MEITUAN_SHOP_INFO;
      const shopDetails = `åº—é“ºåç§°ï¼š${shopInfo.name}\nåº—é“ºåœ°å€ï¼š${shopInfo.address}\nè”ç³»ç”µè¯ï¼š${shopInfo.phone}`;
      const webUrl = PLATFORM_URLS.meituan;
      
      console.log('æµ‹è¯•3: ç½‘é¡µç‰ˆé“¾æ¥');
      status.textContent = `æµ‹è¯•3: ç¾å›¢ç½‘é¡µç‰ˆé“¾æ¥\n\n${shopDetails}\n\nå°è¯•é“¾æ¥: ${webUrl}`;
      
      try {
        window.open(webUrl, '_blank');
        status.textContent = `æµ‹è¯•3å®Œæˆï¼\n\n${shopDetails}\n\nç½‘é¡µç‰ˆåº—é“ºé¡µé¢å·²æ‰“å¼€`;
      } catch (e) {
        console.log('æµ‹è¯•3å¤±è´¥:', e);
        status.textContent = `æµ‹è¯•3å¤±è´¥ï¼š${e.message}`;
      }
    }
    
    // æµ‹è¯•4: å¤åˆ¶é“¾æ¥
    function testCopyLink() {
      const shopInfo = MEITUAN_SHOP_INFO;
      const shopDetails = `åº—é“ºåç§°ï¼š${shopInfo.name}\nåº—é“ºåœ°å€ï¼š${shopInfo.address}\nè”ç³»ç”µè¯ï¼š${shopInfo.phone}`;
      const webUrl = PLATFORM_URLS.meituan;
      
      console.log('æµ‹è¯•4: å¤åˆ¶é“¾æ¥');
      status.textContent = `æµ‹è¯•4: å¤åˆ¶åº—é“ºé“¾æ¥\n\n${shopDetails}\n\næ­£åœ¨å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿...`;
      
      try {
        // å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿
        navigator.clipboard.writeText(webUrl).then(() => {
          status.textContent = `æµ‹è¯•4å®Œæˆï¼\n\n${shopDetails}\n\nåº—é“ºé“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\né“¾æ¥: ${webUrl}\n\nè¯·æ‰‹åŠ¨æ‰“å¼€ç¾å›¢APPï¼Œç²˜è´´é“¾æ¥è®¿é—®åº—é“º`;
        }).catch(() => {
          // å¤‡ç”¨æ–¹æ¡ˆï¼šåˆ›å»ºä¸´æ—¶è¾“å…¥æ¡†
          const textArea = document.createElement('textarea');
          textArea.value = webUrl;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          status.textContent = `æµ‹è¯•4å®Œæˆï¼\n\n${shopDetails}\n\nåº—é“ºé“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\né“¾æ¥: ${webUrl}\n\nè¯·æ‰‹åŠ¨æ‰“å¼€ç¾å›¢APPï¼Œç²˜è´´é“¾æ¥è®¿é—®åº—é“º`;
        });
          } catch (e) {
        console.log('æµ‹è¯•4å¤±è´¥:', e);
        status.textContent = `æµ‹è¯•4å¤±è´¥ï¼š${e.message}`;
      }
    }
    
    // æµ‹è¯•5: æŠ–éŸ³é“¾æ¥
    function testDouyinLink() {
      const url = PLATFORM_URLS.douyin;
      
      console.log('æµ‹è¯•5: æŠ–éŸ³é“¾æ¥');
      status.textContent = `æµ‹è¯•5: æŠ–éŸ³åº—é“ºé“¾æ¥\n\nå°è¯•é“¾æ¥: ${url}`;
      
      try {
        window.open(url, '_blank');
        status.textContent = `æµ‹è¯•5å®Œæˆï¼\n\næŠ–éŸ³åº—é“ºé¡µé¢å·²æ‰“å¼€\n\né“¾æ¥: ${url}`;
      } catch (e) {
        console.log('æµ‹è¯•5å¤±è´¥:', e);
        status.textContent = `æµ‹è¯•5å¤±è´¥ï¼š${e.message}`;
      }
    }
    
    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    btnTest1.addEventListener("click", testSmartJump);
    btnTest2.addEventListener("click", testAppDetectionJump);
    btnTest3.addEventListener("click", testWebLink);
    btnTest4.addEventListener("click", testCopyLink);
    btnTest5.addEventListener("click", testDouyinLink);
  </script>
  
</body>
</html>