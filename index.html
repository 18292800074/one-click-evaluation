<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä¼˜è´¨è¯„ä»·æ–‡æ¡ˆç”Ÿæˆå™¨</title>
  <style>
    * { 
      box-sizing: border-box; 
      -webkit-tap-highlight-color: transparent;
    }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
      background-attachment: fixed;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(217, 70, 239, 0.2) 0%, transparent 50%);
      animation: float 15s ease-in-out infinite;
      pointer-events: none;
    }
    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }
    .container { 
      max-width: 640px; 
      margin: 0 auto; 
      padding: 12px 12px 24px; 
    }
    .card { 
      background: rgba(255, 255, 255, 0.95); 
      border-radius: 24px; 
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.3),
        0 0 0 1px rgba(255,255,255,0.8) inset,
        0 0 100px rgba(139, 92, 246, 0.1); 
      padding: 20px; 
      backdrop-filter: blur(20px);
      position: relative;
      z-index: 1;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 24px;
      padding: 2px;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.5), rgba(217, 70, 239, 0.5));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.6;
      pointer-events: none;
    }
    h1 { 
      font-size: 26px; 
      margin: 0 0 6px; 
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      text-align: center;
      letter-spacing: 0.5px;
    }
    h1::after {
      content: '';
      display: block;
      width: 60px;
      height: 4px;
      background: linear-gradient(90deg, #6366f1, #d946ef);
      margin: 8px auto 0;
      border-radius: 2px;
    }
    label { 
      display: block; 
      font-size: 14px; 
      color: #333; 
      margin: 0; 
      font-weight: 600; 
    }
    
    /* ä¿®å¤å¾®ä¿¡æµè§ˆå™¨ä¸‹æ‹‰æ¡†æ ·å¼é—®é¢˜ */
    select { 
      width: 100%; 
      padding: 14px 16px; 
      border-radius: 12px; 
      border: 2px solid #e5e7eb; 
      outline: none; 
      font-size: 15px;
      background: #fff;
      color: #333;
      font-weight: 600;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238b5cf6' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 20px;
      padding-right: 44px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: all 0.3s;
    }
    select:hover {
      border-color: #c7d2fe;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
    }
    select:focus { 
      border-color: #8b5cf6; 
      box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.15), 0 4px 12px rgba(139, 92, 246, 0.2);
    }
    select option {
      padding: 10px;
      font-size: 16px;
      color: #333;
    }
    
    .actions { 
      display: flex; 
      gap: 10px; 
      margin-top: 16px; 
      flex-direction: column;
    }
    button { 
      cursor: pointer; 
      border: none; 
      padding: 14px 18px; 
      border-radius: 10px; 
      font-size: 15px; 
      font-weight: 600;
      transition: all 0.2s;
      width: 100%;
      -webkit-appearance: none;
      touch-action: manipulation;
    }
    button:active { 
      transform: scale(0.98); 
      opacity: 0.9;
    }
    .btn-primary { 
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%); 
      color: #fff;
      box-shadow: 
        0 8px 24px rgba(139, 92, 246, 0.5),
        0 0 40px rgba(217, 70, 239, 0.2);
      position: relative;
      overflow: hidden;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.4);
      transform: translate(-50%, -50%);
      transition: width 0.5s, height 0.5s;
    }
    .btn-primary:active::before {
      width: 400px;
      height: 400px;
    }
    .btn-primary::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .btn-secondary { 
      background: #fff; 
      color: #6366f1; 
      border: 2px solid #c7d2fe; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      font-weight: 600;
    }
    .btn-secondary:not(:disabled):hover {
      border-color: #8b5cf6;
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.2);
    }
    .btn-secondary:disabled { 
      opacity: 0.5; 
      cursor: not-allowed; 
      box-shadow: none;
      background: #f3f4f6;
      color: #9ca3af;
      border-color: #e5e7eb;
    }
    .result { 
      margin-top: 12px; 
      padding: 16px; 
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); 
      border: 2px solid #fbbf24; 
      border-radius: 12px; 
      white-space: pre-wrap; 
      word-break: break-word; 
      font-size: 14px; 
      line-height: 1.7;
      color: #78350f;
      max-height: 180px;
      overflow-y: auto;
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2), 0 0 0 1px rgba(251, 191, 36, 0.1) inset;
      position: relative;
    }
    .result::before {
      content: 'ğŸ“';
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 20px;
      opacity: 0.3;
    }
    .muted { 
      color: #64748b; 
      font-size: 12px; 
      margin-top: 8px; 
      text-align: center;
    }
    .footer { 
      text-align: center; 
      color: #fff; 
      font-size: 11px; 
      margin-top: 16px; 
      opacity: 0.85;
    }
    .checkbox-group {
      display: flex; 
      flex-wrap: wrap; 
      gap: 8px; 
      margin: 10px 0;
    }
    .checkbox-label {
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
      font-size: 15px; 
      color: #555; 
      cursor: pointer;
      padding: 10px 16px;
      background: #fff;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid #e5e7eb;
      user-select: none;
      -webkit-user-select: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .checkbox-label:hover {
      border-color: #c7d2fe;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
    }
    .checkbox-label:active {
      transform: scale(0.96);
    }
    .checkbox-label input {
      margin: 0;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .checkbox-label input:checked {
      accent-color: #8b5cf6;
    }
    .checkbox-label:has(input:checked) {
      background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
      border-color: #8b5cf6;
      box-shadow: 0 6px 16px rgba(139, 92, 246, 0.3), 0 0 20px rgba(139, 92, 246, 0.1);
      transform: translateY(-2px);
    }
    .checkbox-label:has(input:checked) span {
      background: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }
    
    /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
    @media (max-width: 640px) {
      .container { padding: 10px 10px 20px; }
      .card { padding: 14px 12px; }
      h1 { font-size: 18px; margin-bottom: 10px; }
      .checkbox-label { padding: 5px 8px; font-size: 12px; }
      button { padding: 12px 16px; font-size: 14px; }
      select { padding: 10px 12px; font-size: 14px; }
    }
    
    /* å¾®ä¿¡å¼•å¯¼é®ç½© */
    .wechat-mask {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .wechat-mask.show {
      display: flex;
    }
    .wechat-arrow {
      position: absolute;
      top: 10px;
      right: 20px;
      width: 0;
      height: 0;
      border-left: 30px solid transparent;
      border-right: 30px solid transparent;
      border-top: 40px solid #fff;
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(10px); }
    }
    .wechat-content {
      background: #fff;
      border-radius: 16px;
      padding: 32px 24px;
      max-width: 340px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .wechat-content .icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    .wechat-content h2 {
      margin: 0 0 12px;
      font-size: 20px;
      color: #333;
      font-weight: 700;
    }
    .wechat-content p {
      margin: 8px 0;
      color: #666;
      font-size: 15px;
      line-height: 1.8;
    }
    .wechat-content .steps {
      margin: 20px 0;
      text-align: left;
      background: #f9fafb;
      padding: 16px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.8;
      color: #555;
    }
    .wechat-content button {
      margin-top: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      padding: 14px 28px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }
  </style>
  <meta name="referrer" content="no-referrer">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ’¬ è¯„ä»·æ–‡æ¡ˆç”Ÿæˆ</h1>
      
      <div style="display: flex; gap: 12px; margin: 16px 0;">
        <div style="flex: 1;">
          <label style="margin: 0 0 8px;">âœ‚ï¸ ç±»ç›®</label>
          <div class="checkbox-group" style="gap: 6px;">
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="å‰ªå‘"><span>å‰ªå‘</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="çƒ«å‘"><span>çƒ«å‘</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="æŸ“å‘"><span>æŸ“å‘</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="æŠ¤ç†"><span>æŠ¤ç†</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="é€ å‹"><span>é€ å‹</span>
        </label>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 12px; margin: 12px 0;">
        <div style="flex: 1;">
          <label style="margin: 0 0 8px;">ğŸ‘¤ æœåŠ¡äººå‘˜ <span style="color: #999; font-size: 12px; font-weight: 400;">(å¯é€‰)</span></label>
          <div class="checkbox-group" style="gap: 6px;">
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="è–‡è–‡è€å¸ˆ"><span>è–‡è–‡è€å¸ˆ</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="èµµè€å¸ˆ"><span>èµµè€å¸ˆ</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="æè€å¸ˆ"><span>æè€å¸ˆ</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="æ´‹å­è€å¸ˆ"><span>æ´‹å­è€å¸ˆ</span>
        </label>
            <label class="checkbox-label" style="padding: 6px 10px; font-size: 13px;">
              <input type="checkbox" value="å°æ°"><span>å°æ°</span>
        </label>
          </div>
        </div>
      </div>

      <label for="shopPlatform" style="margin: 12px 0 8px;">ğŸª å¹³å°</label>
      <select id="shopPlatform">
        <option value="meituan">ğŸ’‡ ç¾å›¢ç¾å‘</option>
        <option value="dianping">â­ å¤§ä¼—ç‚¹è¯„</option>
        <option value="douyin">ğŸµ æŠ–éŸ³</option>
      </select>

      <div class="actions" style="margin-top: 16px; gap: 10px;">
        <button id="btnGen" class="btn-primary">ç”Ÿæˆæ–‡æ¡ˆ</button>
        <button id="btnCopyGo" class="btn-secondary" disabled>å¤åˆ¶å¹¶è·³è½¬</button>
      </div>

      <div id="result" class="result" style="display:none;"></div>
      <div id="status" class="muted"></div>
    </div>
    <div class="footer">ä½¿ç”¨ DeepSeek AI æ™ºèƒ½ç”Ÿæˆï¼Œæ— éœ€é…ç½®ç›´æ¥ä½¿ç”¨</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const btnGen = $("btnGen");
    const btnCopyGo = $("btnCopyGo");
    const result = $("result");
    const status = $("status");
    
    // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­
    function isWechat() {
      const ua = navigator.userAgent.toLowerCase();
      return ua.includes('micromessenger');
    }
    
    // æ˜¾ç¤ºå¾®ä¿¡å¼•å¯¼é®ç½©
    function showWechatGuide() {
      const mask = document.createElement('div');
      mask.className = 'wechat-mask show';
      mask.innerHTML = `
        <div class="wechat-arrow"></div>
        <div class="wechat-content">
          <div class="icon">ğŸ“±</div>
          <h2>è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</h2>
          <p>å½“å‰åœ¨å¾®ä¿¡ä¸­æ‰“å¼€ï¼Œæ— æ³•è°ƒèµ·ç¾å›¢/æŠ–éŸ³APP</p>
          <div class="steps">
            <div>ğŸ“ æ“ä½œæ­¥éª¤ï¼š</div>
            <div style="margin-top: 8px;">
              1ï¸âƒ£ ç‚¹å‡»å³ä¸Šè§’"<b>...</b>"<br>
              2ï¸âƒ£ é€‰æ‹©"<b>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</b>"<br>
              3ï¸âƒ£ ç„¶åå³å¯æ­£å¸¸ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½
            </div>
          </div>
          <button onclick="this.parentElement.parentElement.classList.remove('show')">æˆ‘çŸ¥é“äº†</button>
        </div>
      `;
      document.body.appendChild(mask);
    }
    
    // é¡µé¢åŠ è½½æ—¶æ£€æµ‹
    if (isWechat()) {
      // å»¶è¿Ÿæ˜¾ç¤ºï¼Œç¡®ä¿é¡µé¢åŠ è½½å®Œæˆ
      window.addEventListener('DOMContentLoaded', () => {
        setTimeout(showWechatGuide, 500);
      });
    }
    
    // å¹³å°æ·±åº¦é“¾æ¥é…ç½®
    const DEEP_LINKS = {
      meituan: "imeituan://www.meituan.com/food/poi/detail?id=1033453100",  // ç¾å›¢åº—é“ºæ·±åº¦é“¾æ¥
      dianping: "dianping://shopinfo?shopuuid=k6JZYlytyJ0q9Mze",  // å¤§ä¼—ç‚¹è¯„åº—é“ºæ·±åº¦é“¾æ¥
      douyin: "snssdk1128://poi/detail/?id=7375105554814863423"  // æŠ–éŸ³åº—é“ºæ·±åº¦é“¾æ¥
    };
    
    // åº—é“ºä¿¡æ¯é…ç½®
    const SHOP_INFO = {
      name: "æå°å¯»é€ å‹ï¼ˆé™…åå¹¿åœºåº—ï¼‰",
      address: "é›å¡”åŒºæ˜†æ˜æ± è·¯é‡‘è¾‰æ‚¦åºœå°åŒ—é—¨é—¨å£",
      phone: "17602910667",
      meituan: {
        url: "http://dpurl.cn/ipWBl40z"  // ç¾å›¢ç½‘é¡µç‰ˆé“¾æ¥
      },
      dianping: {
        url: "https://www.dianping.com/shop/k6JZYlytyJ0q9Mze"  // å¤§ä¼—ç‚¹è¯„ç½‘é¡µç‰ˆé“¾æ¥
      },
      douyin: {
        url: ""  // æŠ–éŸ³ç½‘é¡µç‰ˆé“¾æ¥ï¼ˆå¦‚æœ‰ï¼‰
      }
    };
    
    // å…¼å®¹æ—§ä»£ç 
    const MEITUAN_SHOP_INFO = {
      name: SHOP_INFO.name,
      address: SHOP_INFO.address,
      phone: SHOP_INFO.phone,
      url: SHOP_INFO.meituan.url
    };
    
    // ç¾å›¢APPæ·±åº¦é“¾æ¥é…ç½®
    const MEITUAN_APP_SCHEME = "imeituan://www.meituan.com/";
    const MEITUAN_SHOP_DEEP_LINK = "imeituan://www.meituan.com/shop/";
    const MEITUAN_FALLBACK_URL = "http://dpurl.cn/ipWBl40z";
    
    // DeepSeek é…ç½®ï¼ˆå†…ç½®ï¼‰
    const DEEPSEEK_CONFIG = {
      apiBase: "https://api.deepseek.com/v1",
      apiKey: "sk-33d4ff5bcb004f26a62cd6f17df25a78",
      model: "deepseek-chat"
    };

    function cutToLength(text, len) {
      if (!text) return "";
      const t = text.replace(/\s+/g, "");
      if (t.length <= len) return t;
      // ä¿ç•™è¯­ä¹‰ï¼Œå°½é‡åœ¨å¥å·/é¡¿å·å¤„æˆªæ–­
      const slice = t.slice(0, len + 4);
      const pivot = Math.max(slice.lastIndexOf("ã€‚"), slice.lastIndexOf("ï¼"), slice.lastIndexOf("ï¼›"), slice.lastIndexOf("ï¼Œ"));
      return (pivot > len - 20 ? slice.slice(0, pivot + 1) : t.slice(0, len)).trim();
    }

    async function callChatCompletions({ apiBase, apiKey, model, system, user, temperature = 0.7, maxTokens = 300 }) {
      const url = apiBase.replace(/\/$/, "") + "/chat/completions";
      const resp = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + apiKey
        },
        body: JSON.stringify({
          model,
          messages: [
            { role: "system", content: system },
            { role: "user", content: user }
          ],
          temperature,
          max_tokens: maxTokens
        })
      });
      if (!resp.ok) {
        let text = await resp.text().catch(() => "");
        throw new Error(`HTTP ${resp.status}: ${text}`);
      }
      const data = await resp.json();
      const content = data?.choices?.[0]?.message?.content || "";
      return content.trim();
    }

    async function generate() {
      // è·å–é€‰ä¸­çš„ç±»ç›®
      const checkedCategories = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .map(cb => cb.value);
      const category = checkedCategories.length > 0 ? checkedCategories.join('ã€') : "ç¾å‘æœåŠ¡";
      
      // è·å–é€‰ä¸­çš„æœåŠ¡äººå‘˜
      const checkedStaff = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .filter(cb => ['è–‡è–‡è€å¸ˆ', 'èµµè€å¸ˆ', 'æè€å¸ˆ', 'æ´‹å­è€å¸ˆ', 'å°æ°'].includes(cb.value))
        .map(cb => cb.value);
      const staff = checkedStaff.length > 0 ? checkedStaff.join('ã€') : "";
      
      // å†…ç½®100-240å­—éšæœº
      const targetLength = Math.floor(Math.random() * 141) + 100; // 100-240éšæœº
      
      // 30+ç§çœŸå®è¯„ä»·é£æ ¼
      const styles = [
        "ç®€çŸ­ç›´ç™½å‹ï¼šåƒå‘æœ‹å‹åœˆï¼Œä¸‰è¨€ä¸¤è¯­è¯´é‡ç‚¹",
        "ç»†èŠ‚ä½“éªŒå‹ï¼šæè¿°å…·ä½“çš„æœåŠ¡ç»†èŠ‚å’Œæ„Ÿå—",
        "å¯¹æ¯”æƒŠå–œå‹ï¼šå¯¹æ¯”ä¹‹å‰ç»å†ï¼Œè¿™æ¬¡æ›´å¥½",
        "é—²èŠæ¨èå‹ï¼šåƒè·Ÿæœ‹å‹èŠå¤©ä¸€æ ·è‡ªç„¶",
        "æ„Ÿæ€§è¡¨è¾¾å‹ï¼šä»ä¸ªäººå¿ƒæƒ…å’Œå˜åŒ–å‡ºå‘",
        "å®ç”¨ä¸»ä¹‰å‹ï¼šé‡ç‚¹è¯´æ•ˆæœå’Œä½“éªŒ",
        "é¦–æ¬¡å°è¯•å‹ï¼šç¬¬ä¸€æ¬¡æ¥çš„æ–°é²œæ„Ÿå—",
        "è€é¡¾å®¢å‹ï¼šæ¥è¿‡å‡ æ¬¡ï¼Œåˆ†äº«ç†Ÿæ‚‰çš„æ„Ÿè§‰",
        "æ„å¤–æƒŠå–œå‹ï¼šæœ¬æ²¡æŠ±å¤ªå¤§å¸Œæœ›ï¼Œç»“æœå¾ˆå¥½",
        "æœ‹å‹é™ªåŒå‹ï¼šè·Ÿæœ‹å‹ä¸€èµ·æ¥çš„è½»æ¾æ°›å›´",
        "éšæ€§è‡ªç„¶å‹ï¼šè·¯è¿‡è¿›æ¥çœ‹çœ‹çš„éšæ„",
        "å›¢è´­æ»¡æ„å‹ï¼šå›¢è´­æ¥çš„ï¼Œæ„Ÿè§‰å¾ˆå€¼",
        "äºŒæ¬¡å…‰é¡¾å‹ï¼šä¸Šæ¬¡æ»¡æ„æ‰€ä»¥åˆæ¥äº†",
        "è°¨æ…é€‰æ‹©å‹ï¼šç²¾æŒ‘ç»†é€‰åçš„æ»¡æ„",
        "å¹³å’Œè®°å½•å‹ï¼šå¹³æ·¡ä½†çœŸå®çš„æ»¡æ„ä½“éªŒ",
        "å¿«èŠ‚å¥å‹ï¼šè¯´è¯ç›´æ¥ç®€å•æ˜äº†",
        "æ…¢èŠ‚å¥å‹ï¼šæ‚ é—²èˆ’é€‚çš„äº«å—è¿‡ç¨‹",
        "ç†æ€§è¯„ä¼°å‹ï¼šå®¢è§‚ç†æ€§åœ°åˆ†äº«ä½“éªŒ",
        "çƒ­æƒ…åˆ†äº«å‹ï¼šå¼€å¿ƒåœ°åˆ†äº«å¥½ä½“éªŒ",
        "ä½è°ƒæ»¡æ„å‹ï¼šä¸å¤¸å¼ åœ°è¡¨è¾¾æ»¡æ„",
        "æƒŠè‰³æ¨èå‹ï¼šçœŸçš„å¾ˆæƒŠè‰³æƒ³æ¨è",
        "èˆ’é€‚äº«å—å‹ï¼šå¼ºè°ƒèˆ’é€‚æ”¾æ¾çš„æ„Ÿè§‰",
        "æŠ€æœ¯è®¤å¯å‹ï¼šè®¤å¯æŠ€æœ¯å’Œæ‰‹æ³•",
        "æœåŠ¡èµèµå‹ï¼šæœåŠ¡è®©äººèˆ’å¿ƒ",
        "ç¯å¢ƒå–œçˆ±å‹ï¼šå–œæ¬¢åº—é‡Œçš„æ°›å›´",
        "æ•ˆæœæ»¡æ„å‹ï¼šå¯¹æœ€ç»ˆæ•ˆæœå¾ˆæ»¡æ„",
        "ç‰©æœ‰æ‰€å€¼å‹ï¼šè§‰å¾—èŠ±çš„é’±å€¼",
        "ä¾¿åˆ©å¥½è¯„å‹ï¼šä½ç½®æ–¹ä¾¿æœåŠ¡ä¾¿åˆ©",
        "æ¸©é¦¨æ„Ÿå—å‹ï¼šæ„Ÿå—åˆ°æ¸©é¦¨å’Œè´´å¿ƒ",
        "ä¸“ä¸šè®¤åŒå‹ï¼šè®¤åŒä¸“ä¸šåº¦å’Œæ°´å¹³",
        "è´´å¿ƒæœåŠ¡å‹ï¼šç»†èŠ‚å¤„çš„è´´å¿ƒæœåŠ¡",
        "æ„‰å¿«ä½“éªŒå‹ï¼šæ•´ä¸ªè¿‡ç¨‹å¾ˆæ„‰å¿«"
      ];
      
      const randomStyle = styles[Math.floor(Math.random() * styles.length)];
      
      // 30+ç§è¡¨è¾¾è§’åº¦
      const perspectives = [
        "ä»å‘å‹æ•ˆæœå…¥æ‰‹",
        "ä»æœåŠ¡æ€åº¦å…¥æ‰‹",
        "ä»ç¯å¢ƒæ°›å›´å…¥æ‰‹",
        "ä»æ€§ä»·æ¯”å…¥æ‰‹",
        "ä»æŠ€æœ¯æ‰‹æ³•å…¥æ‰‹",
        "ä»æ•´ä½“ä½“éªŒå…¥æ‰‹",
        "ä»ä¸ªäººå˜åŒ–å…¥æ‰‹",
        "ä»é¢„çº¦æµç¨‹å…¥æ‰‹",
        "ä»æ²Ÿé€šè¿‡ç¨‹å…¥æ‰‹",
        "ä»äº§å“ä½¿ç”¨å…¥æ‰‹",
        "ä»åº—é“ºä½ç½®å…¥æ‰‹",
        "ä»è£…ä¿®é£æ ¼å…¥æ‰‹",
        "ä»éŸ³ä¹æ°›å›´å…¥æ‰‹",
        "ä»å«ç”Ÿæ¸…æ´å…¥æ‰‹",
        "ä»æœ‹å‹æ¨èå…¥æ‰‹",
        "ä»å¶ç„¶å‘ç°å…¥æ‰‹",
        "ä»è€é¡¾å®¢è§’åº¦å…¥æ‰‹",
        "ä»ä¸“ä¸šç¨‹åº¦å…¥æ‰‹",
        "ä»ç»†å¿ƒç¨‹åº¦å…¥æ‰‹",
        "ä»è€å¿ƒç¨‹åº¦å…¥æ‰‹",
        "ä»åˆ›æ„è®¾è®¡å…¥æ‰‹",
        "ä»å®é™…éœ€æ±‚å…¥æ‰‹",
        "ä»ç¬¬ä¸€å°è±¡å…¥æ‰‹",
        "ä»æœ€ç»ˆæˆæœå…¥æ‰‹",
        "ä»èˆ’é€‚åº¦å…¥æ‰‹",
        "ä»æ–¹ä¾¿ç¨‹åº¦å…¥æ‰‹",
        "ä»æƒŠå–œæ„Ÿå…¥æ‰‹",
        "ä»æ”¾æ¾æ„Ÿå…¥æ‰‹",
        "ä»ä¿¡ä»»æ„Ÿå…¥æ‰‹",
        "ä»æ»¡æ„åº¦å…¥æ‰‹",
        "ä»å˜ç¾æ•ˆæœå…¥æ‰‹",
        "ä»å¿ƒæƒ…å˜åŒ–å…¥æ‰‹"
      ];
      
      const randomPerspective = perspectives[Math.floor(Math.random() * perspectives.length)];
      
      // 30+ç§å¼€å¤´æ–¹å¼
      const openings = [
        "ä»Šå¤©æ¥",
        "å‘¨æœ«è¿‡æ¥",
        "æœ‹å‹æ¨èæ¥çš„",
        "ç¬¬ä¸€æ¬¡æ¥",
        "åˆæ¥äº†",
        "å›¢è´­è¿‡æ¥çš„",
        "è·¯è¿‡è¿›æ¥çœ‹çœ‹",
        "æ˜¨å¤©é¢„çº¦çš„",
        "ä¸‹ç­è¿‡æ¥",
        "é€›è¡—è·¯è¿‡",
        "çœ‹è¯„ä»·ä¸é”™æ¥çš„",
        "ä¹‹å‰æ¥è¿‡",
        "å¬åŒäº‹è¯´",
        "åœ¨ç½‘ä¸Šçœ‹åˆ°",
        "é™„è¿‘æ‰¾äº†å®¶",
        "æ—©å°±æƒ³æ¥",
        "ç»ˆäºæœ‰æ—¶é—´",
        "è¶ç€æœ‰æ´»åŠ¨",
        "æ­£å¥½æœ‰ç©º",
        "ä¸“é—¨è¿‡æ¥",
        "é¡ºè·¯è¿‡æ¥",
        "çº¦äº†æœ‹å‹",
        "ä¸€ç›´æƒ³æ¢å‘å‹",
        "é—ºèœœæ¨è",
        "ä¸‹åˆæ¥",
        "ä¸Šåˆè¿‡æ¥",
        "ä¸­åˆæ¥",
        "æ™šä¸Šæ¥",
        "æ”¾å‡æ¥",
        "å‘¨ä¸­æ¥",
        "æå‰é¢„çº¦äº†",
        "ä¸´æ—¶å†³å®š",
        "æ—©å°±å…³æ³¨äº†",
        "ç­‰äº†å¥½ä¹…"
      ];
      const randomOpening = openings[Math.floor(Math.random() * openings.length)];
      
      // 40+ç§çœŸå®ç»†èŠ‚ï¼ˆå…¨éƒ¨æ­£é¢ï¼‰
      const aspects = [
        "å¯ä»¥æåˆ°é¢„çº¦å¾ˆæ–¹ä¾¿",
        "å¯ä»¥æåˆ°ä»·æ ¼æŒºåˆç†",
        "å¯ä»¥æåˆ°ä½ç½®å¥½æ‰¾",
        "å¯ä»¥æåˆ°åœè½¦æ–¹ä¾¿",
        "å¯ä»¥æåˆ°ç¯å¢ƒèˆ’é€‚",
        "å¯ä»¥æåˆ°éŸ³ä¹å¥½å¬",
        "å¯ä»¥æåˆ°è£…ä¿®æœ‰å“ä½",
        "å¯ä»¥æåˆ°äº§å“å‘³é“å¥½é—»",
        "å¯ä»¥æåˆ°æ´—å‘æ°´è´¨é‡å¥½",
        "å¯ä»¥æåˆ°æŒ‰æ‘©æ‰‹æ³•èˆ’æœ",
        "å¯ä»¥æåˆ°äººæµé€‚ä¸­",
        "å¯ä»¥æåˆ°ä¸ä¼šæ¨é”€",
        "å¯ä»¥æåˆ°èŒ¶æ°´é¥®å“è´´å¿ƒ",
        "å¯ä»¥æåˆ°å«ç”Ÿå¹²å‡€",
        "å¯ä»¥æåˆ°ç©ºè°ƒæ¸©åº¦èˆ’é€‚",
        "å¯ä»¥æåˆ°å…‰çº¿æŸ”å’Œ",
        "å¯ä»¥æåˆ°é•œå­æ¸…æ™°",
        "å¯ä»¥æåˆ°åº§æ¤…èˆ’é€‚",
        "å¯ä»¥æåˆ°å·¥å…·å¹²å‡€",
        "å¯ä»¥æåˆ°æ²Ÿé€šé¡ºç•…",
        "å¯ä»¥æåˆ°å»ºè®®ä¸“ä¸š",
        "å¯ä»¥æåˆ°æ—¶é—´æŠŠæ§å¥½",
        "å¯ä»¥æåˆ°ç»†èŠ‚åˆ°ä½",
        "å¯ä»¥æåˆ°æ”¶å°¾ä»”ç»†",
        "å¯ä»¥æåˆ°æ‰“ç†å»ºè®®å®ç”¨",
        "å¯ä»¥æåˆ°åç»­æŠ¤ç†æŒ‡å¯¼",
        "å¯ä»¥æåˆ°è¿˜ä¼šå†æ¥",
        "å¯ä»¥æåˆ°äº¤é€šä¾¿åˆ©",
        "å¯ä»¥æåˆ°å‘¨è¾¹é…å¥—å¥½",
        "å¯ä»¥æåˆ°è¥ä¸šæ—¶é—´åˆé€‚",
        "å¯ä»¥æåˆ°ä¼šå‘˜ä¼˜æƒ å®åœ¨",
        "å¯ä»¥æåˆ°æ´»åŠ¨ç»™åŠ›",
        "å¯ä»¥æåˆ°æ”¯ä»˜æ–¹ä¾¿",
        "å¯ä»¥æåˆ°å‘˜å·¥çƒ­æƒ…",
        "å¯ä»¥æåˆ°å»ºè®®ä¸­è‚¯",
        "å¯ä»¥æåˆ°ä¸ªæ€§åŒ–æœåŠ¡å¥½",
        "å¯ä»¥æåˆ°æ°›å›´è½»æ¾",
        "å¯ä»¥æåˆ°æœåŠ¡å‘¨åˆ°",
        "å¯ä»¥æåˆ°æ•ˆç‡é«˜",
        "å¯ä»¥æåˆ°æ€åº¦å¥½"
      ];
      const randomAspect = aspects[Math.floor(Math.random() * aspects.length)];
      
      // 30+ç§å¥å¼ç»“æ„
      const structures = [
        "å¤šç”¨çŸ­å¥ï¼Œç®€æ´æ˜å¿«",
        "é•¿çŸ­å¥ç»“åˆï¼Œæœ‰èŠ‚å¥æ„Ÿ",
        "å¤šç”¨å£è¯­åŒ–è½¬æŠ˜è¯",
        "é‡‡ç”¨æ€»åˆ†æ€»ç»“æ„",
        "é‡‡ç”¨æµæ°´è´¦å¼å™è¿°",
        "é‡‡ç”¨å¯¹è¯å¼è¡¨è¾¾",
        "é‡‡ç”¨æ„Ÿå¹å¼è¯­æ°”",
        "é‡‡ç”¨ç–‘é—®å¼å¼•å…¥",
        "å…ˆè¯´è¿‡ç¨‹åè¯´æ•ˆæœ",
        "å…ˆè¯´æ•ˆæœå†è¯´æ„Ÿå—",
        "æ—¶é—´é¡ºåºå™è¿°",
        "ç©ºé—´é¡ºåºæè¿°",
        "é‡ç‚¹çªå‡ºå¼",
        "å¯¹æ¯”å¼è¡¨è¾¾",
        "é€’è¿›å¼å™è¿°",
        "å¹¶åˆ—å¼æè¿°",
        "ä¸¾ä¾‹è¯´æ˜å¼",
        "æ€»ç»“å½’çº³å¼",
        "æ„Ÿå—åˆ†äº«å¼",
        "ä½“éªŒè®°å½•å¼",
        "å°è±¡æè¿°å¼",
        "å˜åŒ–å¯¹æ¯”å¼",
        "ç»†èŠ‚å±•å¼€å¼",
        "æ°›å›´æ¸²æŸ“å¼",
        "æ•ˆæœå±•ç¤ºå¼",
        "è¿‡ç¨‹å›é¡¾å¼",
        "å¿ƒæƒ…è¡¨è¾¾å¼",
        "è½»æ¾èŠå¤©å¼",
        "éšæ„åˆ†äº«å¼",
        "çœŸè¯šæ¨èå¼"
      ];
      const randomStructure = structures[Math.floor(Math.random() * structures.length)];
      
      // 30+ç§çœŸå®ç”¨è¯ç»„åˆ
      const vocabularies = [
        "æŒºã€è¿˜è¡Œã€ä¸é”™ã€å¯ä»¥ã€è›®å¥½",
        "æ„Ÿè§‰ã€è§‰å¾—ã€å‘ç°ã€çœ‹ç€ã€æ˜¾å¾—",
        "å°±æ˜¯ã€ä¸è¿‡ã€åæ­£ã€æ€»ä¹‹ã€è€Œä¸”ã€æ‰€ä»¥",
        "ç¡®å®ã€çœŸçš„ã€è¯´å®è¯ã€è€å®è¯´ã€å®è¯è¯´",
        "æ¯”è¾ƒã€ç®—æ˜¯ã€åº”è¯¥ã€å¤§æ¦‚ã€å·®ä¸å¤šã€åŸºæœ¬",
        "è¿˜å¥½ã€è¿˜å¯ä»¥ã€è¿˜ä¸èµ–ã€è¿˜æŒºå¥½",
        "æŒºæ»¡æ„ã€æŒºå¥½çš„ã€æŒºèˆ’æœã€æŒºå¿«çš„",
        "è›®å–œæ¬¢ã€è›®å¥½ã€è›®èˆ’æœã€è›®ä¸“ä¸šçš„",
        "å¾ˆæ»¡æ„ã€å¾ˆèˆ’æœã€å¾ˆå–œæ¬¢ã€å¾ˆå¥½",
        "ç›¸å½“ä¸é”™ã€ç›¸å½“æ»¡æ„ã€ç›¸å½“èˆ’æœ",
        "è¶…çº§å¥½ã€è¶…æ»¡æ„ã€è¶…å–œæ¬¢",
        "ç‰¹åˆ«å¥½ã€ç‰¹åˆ«æ»¡æ„ã€ç‰¹åˆ«èˆ’æœ",
        "çœŸå¿ƒä¸é”™ã€çœŸå¿ƒæ»¡æ„ã€çœŸå¿ƒæ¨è",
        "çœ‹ç€ä¸é”™ã€çœ‹ç€æŒºå¥½ã€çœ‹ç€æ»¡æ„",
        "å¬ç€èˆ’æœã€é—»ç€å¥½é—»ã€æ‘¸ç€é¡ºæ»‘",
        "åšå¾—å¥½ã€å‰ªå¾—å¥½ã€çƒ«å¾—å¥½ã€æŸ“å¾—å¥½",
        "å¼„å¾—ä¸é”™ã€æå¾—æŒºå¥½ã€æ•´å¾—æ»¡æ„",
        "æ•ˆæœå¥½ã€æ‰‹æ³•å¥½ã€æŠ€æœ¯å¥½ã€æ€åº¦å¥½",
        "æŒºé è°±ã€æŒºä¸“ä¸šã€æŒºç»†å¿ƒã€æŒºè€å¿ƒ",
        "è›®è®¤çœŸã€è›®ä»”ç»†ã€è›®ç”¨å¿ƒã€è›®è´Ÿè´£",
        "å¾ˆè®¤çœŸã€å¾ˆä»”ç»†ã€å¾ˆç”¨å¿ƒã€å¾ˆè´Ÿè´£",
        "æ¯”æƒ³è±¡ä¸­å¥½ã€æ¯”é¢„æœŸå¥½ã€æ¯”ä¹‹å‰å¥½",
        "è¶Šæ¥è¶Šå¥½ã€ä¸€å¦‚æ—¢å¾€å¥½ã€å§‹ç»ˆå¦‚ä¸€",
        "æ²¡è®©å¤±æœ›ã€æ²¡ç™½æ¥ã€å€¼å¾—æ¥",
        "æ¥å¯¹äº†ã€é€‰å¯¹äº†ã€æ‰¾å¯¹äº†",
        "è¿˜ä¼šæ¥ã€ä¼šå†æ¥ã€ç»§ç»­å…‰é¡¾",
        "å€¼å¾—æ¨èã€å¯ä»¥æ¨èã€æ¨èç»™æœ‹å‹",
        "æ”¾å¿ƒã€å®‰å¿ƒã€èˆ’å¿ƒã€çœå¿ƒ",
        "æ»¡æ„ã€å¼€å¿ƒã€é«˜å…´ã€æ„‰å¿«",
        "å–œæ¬¢ã€é’Ÿæ„ã€ä¸­æ„ã€åˆé€‚"
      ];
      const randomVocabulary = vocabularies[Math.floor(Math.random() * vocabularies.length)];
      
      btnGen.disabled = true; btnGen.textContent = "ç”Ÿæˆä¸­â€¦"; status.textContent = "æ­£åœ¨è¿æ¥AIæœåŠ¡...";
      
      console.log('å¼€å§‹ç”Ÿæˆæ–‡æ¡ˆ...');
      console.log('ç±»ç›®:', category);
      console.log('æœåŠ¡äººå‘˜:', staff);
      console.log('ç›®æ ‡é•¿åº¦:', targetLength);
      console.log('é£æ ¼:', randomStyle);
      console.log('åˆ‡å…¥ç‚¹:', randomPerspective);
      
      try {
        const system = `ä½ æ˜¯ä¸€ä¸ªçœŸå®çš„æ™®é€šé¡¾å®¢ï¼Œåˆšåšå®Œç¾å‘ï¼Œæ­£åœ¨æ‰‹æœºä¸Šå†™å¥½è¯„ã€‚

ã€ç»å¯¹ç¦æ­¢çš„å®˜æ–¹å¥—è¯ã€‘
ç¦ç”¨ï¼šéå¸¸å¥½ã€å¼ºçƒˆæ¨èã€äº”æ˜Ÿå¥½è¯„ã€å€¼å¾—ä¿¡èµ–ã€ä¸“ä¸šå›¢é˜Ÿã€æŠ€æœ¯ç²¾æ¹›ã€æœåŠ¡å‘¨åˆ°ã€ç¯å¢ƒä¼˜é›…ã€æ€§ä»·æ¯”è¶…é«˜ã€ç‰©è¶…æ‰€å€¼

ã€å¿…é¡»ä½¿ç”¨çš„å£è¯­è¡¨è¾¾ã€‘
å¤šç”¨ï¼š${randomVocabulary}

ã€å†™ä½œè¦æ±‚ã€‘
1. åƒè·Ÿæœ‹å‹å¾®ä¿¡èŠå¤©ä¸€æ ·è‡ªç„¶éšæ„
2. ${randomStructure}
3. å…¨éƒ¨éƒ½æ˜¯æ­£é¢å¥½è¯„ï¼Œä½†ç”¨å£è¯­åŒ–è¡¨è¾¾
4. å°±åƒçœŸäººåœ¨æ‰‹æœºä¸Šéšæ‰‹æ‰“å­—
5. è‡ªç„¶çœŸå®ï¼Œä¸åˆ»æ„å †ç Œ

ã€é£æ ¼å®šä½ã€‘
${randomStyle}

ã€åˆ‡å…¥è§’åº¦ã€‘  
${randomPerspective}

ã€çœŸå®ç”¨æˆ·å¸¸è§è¡¨è¾¾ï¼ˆå¥½è¯„ç‰ˆï¼‰ã€‘
- "ä»Šå¤©å‰ªäº†ä¸ªå¤´å‘ï¼ŒæŒºæ»¡æ„çš„"
- "è€å¸ˆæ‰‹è‰ºç¡®å®ä¸é”™"
- "ç¯å¢ƒè¿˜æŒºå¹²å‡€èˆ’æœçš„"
- "è¿™ä¸ªä»·æ ¼è¿˜ç®—å¯ä»¥"
- "ç­‰äº†ä¼šå„¿ï¼Œæ•ˆæœå‡ºæ¥è¿˜æŒºå¥½"
- "æŒºæ»¡æ„çš„ï¼Œæ„Ÿè§‰è¿˜ä¼šæ¥"
- "åšå¾—è›®å¥½çš„ï¼Œæœ‹å‹éƒ½è¯´å¥½çœ‹"
- "æ€»ä½“æ¥è¯´æŒºæ»¡æ„"`;
        
        let userMsg = `å†™ä¸€ä¸ª${category}çš„çœŸå®å¥½è¯„ï¼Œ${targetLength}å­—ã€‚`;
        if (staff) {
          userMsg += `åšçš„æ˜¯${staff}ã€‚`;
        }
        userMsg += `\n\nã€æœ¬æ¬¡ç”Ÿæˆè¦æ±‚ã€‘
1. é£æ ¼ï¼š${randomStyle.split('ï¼š')[0]}
2. åˆ‡å…¥ç‚¹ï¼š${randomPerspective}
3. å¼€å¤´å‚è€ƒï¼š${randomOpening}ï¼ˆä¸è¦ç…§æŠ„ï¼Œè‡ªç„¶å¼•å…¥ï¼‰
4. ç»†èŠ‚äº®ç‚¹ï¼š${randomAspect}
5. å¥å¼ç»“æ„ï¼š${randomStructure}
6. å¸¸ç”¨è¯æ±‡ï¼š${randomVocabulary}
7. å­—æ•°ç²¾ç¡®ï¼š${targetLength}å­—å·¦å³
8. å£è¯­è‡ªç„¶ï¼šåƒæ‰‹æœºæ‰“å­—èŠå¤©
9. é¿å…æ¨¡æ¿åŒ–ï¼šæ¯æ¬¡è¡¨è¾¾æ–¹å¼å®Œå…¨ä¸åŒ
10. å…¨æ˜¯å¥½è¯„ï¼šä½†ä¸è¦å®˜æ–¹è¯æœ¯
11. æ ¼å¼ï¼šçº¯æ–‡æœ¬ï¼Œæ— å¼•å·ã€æ— ç¬¦å·

ã€ç‰¹åˆ«æé†’ã€‘
- å…¨éƒ¨æ­£é¢è¯„ä»·ï¼Œä½†ç”¨å¤§ç™½è¯
- ä¸è¦å†™å¾—åƒå¹¿å‘Šæˆ–å®˜æ–¹æ–‡æ¡ˆ
- åƒä½ è‡ªå·±å»åšå®Œå¤´å‘éšæ‰‹å†™çš„çœŸå®å¥½è¯„
- æ¯æ¬¡ç”¨è¯ã€å¥å¼ã€è¡¨è¾¾è§’åº¦éƒ½è¦æ˜æ˜¾ä¸åŒ`;
        
        status.textContent = "AIæ­£åœ¨ç”Ÿæˆè¯„ä»·...";
        
        const raw = await callChatCompletions({ 
          apiBase: DEEPSEEK_CONFIG.apiBase, 
          apiKey: DEEPSEEK_CONFIG.apiKey, 
          model: DEEPSEEK_CONFIG.model, 
          system, 
          user: userMsg, 
          temperature: 0.9,  // æé«˜æ¸©åº¦å¢åŠ éšæœºæ€§
          maxTokens: 500 
        });
        
        console.log('AIè¿”å›ç»“æœ:', raw);
        
        const text = cutToLength(raw, targetLength);
        result.style.display = "block";
        result.textContent = text;
        btnCopyGo.disabled = !text;
        const actualLength = text.replace(/\s+/g, "").length;
        status.textContent = text ? `âœ… å·²ç”ŸæˆçœŸå®è¯„ä»·ï¼Œå…±${actualLength}å­— | é£æ ¼ï¼š${randomStyle.split('ï¼š')[0]}` : "ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•";
      } catch (e) {
        console.error('ç”Ÿæˆæ–‡æ¡ˆå¤±è´¥:', e);
        result.style.display = "block";
        result.textContent = `ç”Ÿæˆå¤±è´¥ï¼š${e.message}`;
        status.textContent = "âŒ è¯·æ±‚å¤±è´¥ï¼š" + (e && e.message ? e.message : e);
      } finally {
        btnGen.disabled = false; btnGen.textContent = "ç”Ÿæˆæ–‡æ¡ˆ";
      }
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (_) {}
      // æ—§æ–¹æ¡ˆå…œåº•
      const ta = document.createElement("textarea");
      ta.value = text; document.body.appendChild(ta);
      ta.select(); ta.setSelectionRange(0, 99999);
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }

    // è·³è½¬åˆ°åº—é“º
    function jumpToShop() {
      const platform = $("shopPlatform").value;
      const shopInfo = MEITUAN_SHOP_INFO;
      const shopDetails = `åº—é“ºåç§°ï¼š${shopInfo.name}\nåº—é“ºåœ°å€ï¼š${shopInfo.address}\nè”ç³»ç”µè¯ï¼š${shopInfo.phone}`;
      
      const deepLink = DEEP_LINKS[platform];
      const platformNames = {
        meituan: "ç¾å›¢",
        dianping: "å¤§ä¼—ç‚¹è¯„",
        douyin: "æŠ–éŸ³"
      };
      const platformName = platformNames[platform] || platform;
      
      console.log(`è·³è½¬åˆ°${platformName}åº—é“º`);
      status.textContent = `æ­£åœ¨è°ƒèµ·${platformName}APP...\n\n${shopDetails}\n\næ·±åº¦é“¾æ¥: ${deepLink}`;
      
      try {
        // ä½¿ç”¨iframeå°è¯•è°ƒèµ·APP
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = deepLink;
        document.body.appendChild(iframe);
        
        let appOpened = false;
        
        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆAPPæ‰“å¼€æ—¶é¡µé¢ä¼šå¤±å»ç„¦ç‚¹ï¼‰
        const handleVisibilityChange = () => {
          if (document.hidden) {
            appOpened = true;
            status.textContent = `âœ… æˆåŠŸï¼${platformName}APPå·²è°ƒèµ·ï¼\n\n${shopDetails}\n\næ·±åº¦é“¾æ¥: ${deepLink}\n\nè¯·æ£€æŸ¥æ˜¯å¦è·³è½¬åˆ°åº—é“ºä¸»é¡µ`;
            document.removeEventListener('visibilitychange', handleVisibilityChange);
          }
        };
        
        document.addEventListener('visibilitychange', handleVisibilityChange);
        
        // 3ç§’åæ£€æµ‹ï¼Œå¦‚æœå¤±è´¥åˆ™å°è¯•æ‰“å¼€ç½‘é¡µç‰ˆ
            setTimeout(() => {
          if (iframe.parentNode) {
            document.body.removeChild(iframe);
          }
          document.removeEventListener('visibilitychange', handleVisibilityChange);
          
          if (!appOpened) {
            // å¦‚æœæ·±åº¦é“¾æ¥å¤±è´¥ï¼Œå°è¯•æ‰“å¼€ç½‘é¡µç‰ˆï¼ˆç½‘é¡µç‰ˆä¼šè‡ªåŠ¨æç¤ºæ‰“å¼€APPï¼‰
            const webUrl = SHOP_INFO[platform]?.url;
            if (webUrl) {
              status.textContent = `âš ï¸ æ·±åº¦é“¾æ¥è°ƒèµ·å¤±è´¥ï¼Œæ­£åœ¨è·³è½¬åˆ°${platformName}ç½‘é¡µç‰ˆ...\n\n${shopDetails}\n\nç½‘é¡µç‰ˆä¼šè‡ªåŠ¨æç¤ºæ‰“å¼€APP`;
          setTimeout(() => {
                window.location.href = webUrl;
              }, 500);
            } else {
              status.textContent = `âŒ è°ƒèµ·${platformName}APPå¤±è´¥\n\n${shopDetails}\n\næ·±åº¦é“¾æ¥: ${deepLink}\n\nè¯·ç¡®ä¿å·²å®‰è£…${platformName}APP`;
            }
          }
        }, 3000);
        
      } catch (e) {
        console.log(`è°ƒèµ·${platformName}APPå¤±è´¥:`, e);
        status.textContent = `âŒ è°ƒèµ·${platformName}APPå¤±è´¥ï¼š${e.message}\n\n${shopDetails}`;
      }
    }
    
    // å¤åˆ¶å¹¶è·³è½¬
    async function copyAndJump() {
      const text = result.textContent.trim();
      if (!text) return;
      
      const ok = await copyText(text);
      const platform = $("shopPlatform").value;
      const platformNames = {
        meituan: "ç¾å›¢",
        dianping: "å¤§ä¼—ç‚¹è¯„",
        douyin: "æŠ–éŸ³"
      };
      const platformName = platformNames[platform] || "åº—é“º";
      
      if (ok) {
        // å¦‚æœåœ¨å¾®ä¿¡ä¸­ï¼Œæç¤ºç”¨æˆ·
        if (isWechat()) {
          status.textContent = `âœ… æ–‡æ¡ˆå·²å¤åˆ¶ï¼\n\nç”±äºå¾®ä¿¡é™åˆ¶ï¼Œæ— æ³•è‡ªåŠ¨è°ƒèµ·${platformName}APP\n\nè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n1. ç‚¹å‡»å³ä¸Šè§’"..."é€‰æ‹©"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"\n2. æˆ–æ‰‹åŠ¨æ‰“å¼€${platformName}APP\n3. ç²˜è´´è¯„ä»·å†…å®¹`;
          
          // æ˜¾ç¤ºæ“ä½œæç¤ºå¼¹çª—
          setTimeout(() => {
            alert(`âœ… æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nç”±äºå¾®ä¿¡é™åˆ¶ï¼Œæ— æ³•è‡ªåŠ¨è°ƒèµ·${platformName}APP\n\nè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n\n1. ç‚¹å‡»å³ä¸Šè§’"..." \n2. é€‰æ‹©"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"\n3. ç„¶åå†æ¬¡ç‚¹å‡»"å¤åˆ¶å¹¶è·³è½¬"æŒ‰é’®\n\næˆ–è€…ï¼š\n1. æ‰‹åŠ¨æ‰“å¼€${platformName}APP\n2. æ‰¾åˆ°åº—é“º\n3. ç²˜è´´è¯„ä»·å†…å®¹`);
          }, 500);
          
          return;
        }
        
        status.textContent = `æ–‡æ¡ˆå·²å¤åˆ¶ï¼Œæ­£åœ¨æ‰“å¼€${platformName}åº—é“ºâ€¦`;
        
        // è°ƒèµ·APPå¹¶è·³è½¬
        const deepLink = DEEP_LINKS[platform];
        
        try {
          // ä½¿ç”¨iframeå°è¯•è°ƒèµ·APP
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = deepLink;
          document.body.appendChild(iframe);
          
          setTimeout(() => {
            if (iframe.parentNode) {
              document.body.removeChild(iframe);
            }
            status.textContent = `âœ… æ–‡æ¡ˆå·²å¤åˆ¶ï¼Œ${platformName}APPå·²è°ƒèµ·ï¼\n\nè¯·åœ¨APPä¸­ç²˜è´´è¯„ä»·å†…å®¹`;
          }, 2000);
          
        } catch (e) {
          console.log('è°ƒèµ·APPå¤±è´¥:', e);
          status.textContent = `âœ… æ–‡æ¡ˆå·²å¤åˆ¶ï¼\n\nè¯·æ‰‹åŠ¨æ‰“å¼€${platformName}APPå¹¶ç²˜è´´è¯„ä»·å†…å®¹`;
        }
      } else {
        status.textContent = "âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æ¡ˆ";
      }
    }
    
    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    btnGen.addEventListener("click", generate);
    btnCopyGo.addEventListener("click", copyAndJump);
  </script>
  
</body>
</html>