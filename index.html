<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä¼˜è´¨è¯„ä»·æ–‡æ¡ˆç”Ÿæˆå™¨</title>
  <style>
    :root { color-scheme: light dark; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container { max-width: 720px; margin: 0 auto; padding: 24px 16px 48px; }
    .card { 
      background: #fff; 
      border-radius: 16px; 
      box-shadow: 0 8px 32px rgba(0,0,0,0.12); 
      padding: 28px; 
      backdrop-filter: blur(10px);
    }
    h1 { 
      font-size: 28px; 
      margin: 0 0 8px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }
    label { display: block; font-size: 14px; color: #555; margin: 16px 0 8px; font-weight: 500; }
    input[type="checkbox"] { cursor: pointer; }
    select { 
      width: 100%; 
      box-sizing: border-box; 
      padding: 12px 14px; 
      border-radius: 10px; 
      border: 2px solid #e5e7eb; 
      outline: none; 
      font-size: 14px; 
      background: #fff;
      transition: border-color 0.3s;
    }
    select:focus { border-color: #667eea; }
    .actions { display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
    button { 
      cursor: pointer; 
      border: none; 
      padding: 12px 20px; 
      border-radius: 10px; 
      font-size: 15px; 
      font-weight: 500;
      transition: all 0.3s;
      flex: 1;
      min-width: 140px;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    button:active { transform: translateY(0); }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
    .btn-secondary { background: #f3f4f6; color: #374151; border: 2px solid #e5e7eb; }
    .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }
    .result { 
      margin-top: 20px; 
      padding: 16px; 
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
      border: 2px solid #fbbf24; 
      border-radius: 12px; 
      white-space: pre-wrap; 
      word-break: break-word; 
      font-size: 15px; 
      line-height: 1.8;
      box-shadow: 0 4px 12px rgba(251,191,36,0.2);
    }
    .tips { 
      color: #6b7280; 
      font-size: 13px; 
      margin-top: 6px; 
      padding: 12px; 
      background: #f9fafb; 
      border-radius: 8px;
      border-left: 3px solid #667eea;
    }
    .muted { color: #64748b; font-size: 13px; margin-top: 12px; }
    .footer { 
      text-align: center; 
      color: #fff; 
      font-size: 13px; 
      margin-top: 20px; 
      opacity: 0.9;
    }
    .checkbox-group {
      display: flex; 
      flex-wrap: wrap; 
      gap: 10px; 
      margin: 8px 0;
    }
    .checkbox-label {
      display: flex; 
      align-items: center; 
      gap: 6px; 
      font-size: 14px; 
      color: #555; 
      cursor: pointer;
      padding: 6px 12px;
      background: #f9fafb;
      border-radius: 8px;
      transition: all 0.3s;
    }
    .checkbox-label:hover {
      background: #e5e7eb;
    }
    .checkbox-label input:checked + span {
      color: #667eea;
      font-weight: 600;
    }
  </style>
  <meta name="referrer" content="no-referrer">
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ä¼˜è´¨è¯„ä»·æ–‡æ¡ˆç”Ÿæˆå™¨</h1>
      <div class="tips" style="margin-bottom: 20px;">
        ğŸ¤– å·²å†…ç½® DeepSeek AIï¼Œæ™ºèƒ½ç”ŸæˆçœŸå®è¯„ä»· | ğŸ’¡ æ¯æ¬¡é£æ ¼éšæœºï¼Œé¿å…åƒç¯‡ä¸€å¾‹
      </div>

      <label>âœ‚ï¸ ç±»ç›®ï¼ˆå¯å¤šé€‰ï¼‰</label>
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" value="å‰ªå‘" style="margin: 0;"><span>å‰ªå‘</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="çƒ«å‘" style="margin: 0;"><span>çƒ«å‘</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="æŸ“å‘" style="margin: 0;"><span>æŸ“å‘</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="æŠ¤ç†" style="margin: 0;"><span>æŠ¤ç†</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="é€ å‹" style="margin: 0;"><span>é€ å‹</span>
        </label>
      </div>

      <label>ğŸ‘¤ æœåŠ¡äººå‘˜ï¼ˆå¯å¤šé€‰ï¼‰</label>
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" value="è–‡è–‡è€å¸ˆ" style="margin: 0;"><span>è–‡è–‡è€å¸ˆ</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="èµµè€å¸ˆ" style="margin: 0;"><span>èµµè€å¸ˆ</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="æè€å¸ˆ" style="margin: 0;"><span>æè€å¸ˆ</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="æ´‹å­è€å¸ˆ" style="margin: 0;"><span>æ´‹å­è€å¸ˆ</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" value="å°æ°" style="margin: 0;"><span>å°æ°</span>
        </label>
      </div>

      <label for="shopPlatform">ğŸª é€‰æ‹©å¹³å°</label>
      <select id="shopPlatform">
        <option value="meituan">ğŸœ ç¾å›¢åº—é“º</option>
        <option value="douyin">ğŸµ æŠ–éŸ³åº—é“º</option>
      </select>

      <div class="actions">
        <button id="btnGen" class="btn-primary">ç”Ÿæˆæ–‡æ¡ˆ</button>
        <button id="btnCopyGo" class="btn-secondary" disabled>å¤åˆ¶å¹¶è·³è½¬</button>
      </div>

      <div id="result" class="result" style="display:none;"></div>
      <div id="status" class="muted" style="margin-top:8px;"></div>
    </div>
    <div class="footer">ä½¿ç”¨ DeepSeek AI æ™ºèƒ½ç”Ÿæˆï¼Œæ— éœ€é…ç½®ç›´æ¥ä½¿ç”¨</div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const btnGen = $("btnGen");
    const btnCopyGo = $("btnCopyGo");
    const result = $("result");
    const status = $("status");
    
    // å¹³å°æ·±åº¦é“¾æ¥é…ç½®
    const DEEP_LINKS = {
      meituan: "imeituan://www.meituan.com/food/poi/detail?id=1033453100",  // ç¾å›¢åº—é“ºæ·±åº¦é“¾æ¥
      douyin: "snssdk1128://poi/detail/?id=7375105554814863423"  // æŠ–éŸ³åº—é“ºæ·±åº¦é“¾æ¥
    };
    
    // ç¾å›¢åº—é“ºä¿¡æ¯
    const MEITUAN_SHOP_INFO = {
      name: "æå°å¯»é€ å‹ï¼ˆé™…åå¹¿åœºåº—ï¼‰",
      address: "é›å¡”åŒºæ˜†æ˜æ± è·¯é‡‘è¾‰æ‚¦åºœå°åŒ—é—¨é—¨å£",
      phone: "17602910667",
      url: "http://dpurl.cn/ipWBl40z"
    };
    
    // ç¾å›¢APPæ·±åº¦é“¾æ¥é…ç½®
    const MEITUAN_APP_SCHEME = "imeituan://www.meituan.com/";
    const MEITUAN_SHOP_DEEP_LINK = "imeituan://www.meituan.com/shop/";
    const MEITUAN_FALLBACK_URL = "http://dpurl.cn/ipWBl40z";
    
    // DeepSeek é…ç½®ï¼ˆå†…ç½®ï¼‰
    const DEEPSEEK_CONFIG = {
      apiBase: "https://api.deepseek.com/v1",
      apiKey: "sk-33d4ff5bcb004f26a62cd6f17df25a78",
      model: "deepseek-chat"
    };

    function cutToLength(text, len) {
      if (!text) return "";
      const t = text.replace(/\s+/g, "");
      if (t.length <= len) return t;
      // ä¿ç•™è¯­ä¹‰ï¼Œå°½é‡åœ¨å¥å·/é¡¿å·å¤„æˆªæ–­
      const slice = t.slice(0, len + 4);
      const pivot = Math.max(slice.lastIndexOf("ã€‚"), slice.lastIndexOf("ï¼"), slice.lastIndexOf("ï¼›"), slice.lastIndexOf("ï¼Œ"));
      return (pivot > len - 20 ? slice.slice(0, pivot + 1) : t.slice(0, len)).trim();
    }

    async function callChatCompletions({ apiBase, apiKey, model, system, user, temperature = 0.7, maxTokens = 300 }) {
      const url = apiBase.replace(/\/$/, "") + "/chat/completions";
      const resp = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + apiKey
        },
        body: JSON.stringify({
          model,
          messages: [
            { role: "system", content: system },
            { role: "user", content: user }
          ],
          temperature,
          max_tokens: maxTokens
        })
      });
      if (!resp.ok) {
        let text = await resp.text().catch(() => "");
        throw new Error(`HTTP ${resp.status}: ${text}`);
      }
      const data = await resp.json();
      const content = data?.choices?.[0]?.message?.content || "";
      return content.trim();
    }

    async function generate() {
      // è·å–é€‰ä¸­çš„ç±»ç›®
      const checkedCategories = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .map(cb => cb.value);
      const category = checkedCategories.length > 0 ? checkedCategories.join('ã€') : "ç¾å‘æœåŠ¡";
      
      // è·å–é€‰ä¸­çš„æœåŠ¡äººå‘˜
      const checkedStaff = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
        .filter(cb => ['è–‡è–‡è€å¸ˆ', 'èµµè€å¸ˆ', 'æè€å¸ˆ', 'æ´‹å­è€å¸ˆ', 'å°æ°'].includes(cb.value))
        .map(cb => cb.value);
      const staff = checkedStaff.length > 0 ? checkedStaff.join('ã€') : "";
      
      // å†…ç½®100-240å­—éšæœº
      const targetLength = Math.floor(Math.random() * 141) + 100; // 100-240éšæœº
      
      // å¤šæ ·åŒ–çš„è¯„ä»·é£æ ¼
      const styles = [
        "ç®€æ´ç›´æ¥å‹ï¼šè¯­è¨€ç®€ç»ƒï¼Œé‡ç‚¹çªå‡ºï¼Œç›´æ¥è¡¨è¾¾æ»¡æ„åº¦",
        "ç»†èŠ‚æè¿°å‹ï¼šæ³¨é‡ç»†èŠ‚æå†™ï¼ŒåŒ…å«å…·ä½“çš„æœåŠ¡è¿‡ç¨‹å’Œæ„Ÿå—",
        "å¯¹æ¯”æ„Ÿå—å‹ï¼šå¯¹æ¯”ä¹‹å‰çš„ä½“éªŒï¼Œçªå‡ºè¿™æ¬¡çš„æ”¹å˜å’Œæ•ˆæœ",
        "æœ‹å‹æ¨èå‹ï¼šåƒå‘æœ‹å‹æ¨èä¸€æ ·ï¼Œè‡ªç„¶éšæ„çš„è¯­æ°”",
        "ä¸“ä¸šç‚¹è¯„å‹ï¼šç•¥å¸¦ä¸“ä¸šè§’åº¦ï¼Œç‚¹è¯„æŠ€æœ¯å’Œæ•ˆæœ",
        "æ•…äº‹å™è¿°å‹ï¼šç”¨å™è¿°çš„æ–¹å¼è®²è¿°ä½“éªŒè¿‡ç¨‹"
      ];
      
      const randomStyle = styles[Math.floor(Math.random() * styles.length)];
      
      // å¤šæ ·åŒ–çš„è¯­æ°”è¯
      const tones = [
        "è½»æ¾æ„‰å¿«",
        "çœŸè¯šå®åœ¨",
        "å¹³å’Œè‡ªç„¶",
        "çƒ­æƒ…æ´‹æº¢",
        "æ²‰ç¨³è¸å®"
      ];
      
      const randomTone = tones[Math.floor(Math.random() * tones.length)];
      
      btnGen.disabled = true; btnGen.textContent = "ç”Ÿæˆä¸­â€¦"; status.textContent = "";
      try {
        const system = `ä½ æ˜¯ä¸€ä¸ªçœŸå®çš„ç”¨æˆ·ï¼Œæ­£åœ¨ç»™ç¾å‘åº—å†™è¯„ä»·ã€‚è¯·ç”¨è‡ªç„¶ã€çœŸå®çš„è¯­è¨€ï¼Œåƒæ™®é€šæ¶ˆè´¹è€…ä¸€æ ·è¡¨è¾¾è‡ªå·±çš„ä½¿ç”¨æ„Ÿå—ã€‚
é£æ ¼è¦æ±‚ï¼š${randomStyle}
è¯­æ°”è¦æ±‚ï¼š${randomTone}
é¿å…å®˜æ–¹è¯æœ¯ã€è¥é”€è¯æ±‡ï¼Œè¦åƒæœ‹å‹èŠå¤©ä¸€æ ·è‡ªç„¶ã€‚å¯ä»¥åŒ…å«ä¸ªäººä½“éªŒç»†èŠ‚ã€å¯¹æ¯”æ„Ÿå—ã€ä½¿ç”¨åœºæ™¯ç­‰çœŸå®å†…å®¹ã€‚
æ¯æ¬¡ç”Ÿæˆçš„è¯„ä»·è¦æœ‰ä¸åŒçš„è¡¨è¾¾æ–¹å¼å’Œä¾§é‡ç‚¹ï¼Œé¿å…åƒç¯‡ä¸€å¾‹ã€‚`;
        
        let userMsg = `è¯·å¸®æˆ‘å†™ä¸€ä¸ªå…³äº${category}çš„çœŸå®ç”¨æˆ·è¯„ä»·ï¼Œå¤§çº¦${targetLength}å­—å·¦å³ã€‚`;
        if (staff) {
          userMsg += `æœåŠ¡äººå‘˜æ˜¯${staff}ã€‚`;
        }
        userMsg += `\n\nè¦æ±‚ï¼š
1. è¯­è¨€è‡ªç„¶çœŸå®ï¼ŒåƒçœŸäººå†™çš„ï¼Œç¬¦åˆ"${randomStyle}"çš„ç‰¹ç‚¹
2. é¿å…"éå¸¸å¥½"ã€"å¼ºçƒˆæ¨è"ç­‰å¥—è¯
3. å¯ä»¥åŒ…å«å…·ä½“çš„ä½¿ç”¨ç»†èŠ‚å’ŒæœåŠ¡äººå‘˜
4. å­—æ•°æ§åˆ¶åœ¨${targetLength}å­—å·¦å³
5. ä¸è¦åŠ å¼•å·æˆ–è¡¨æƒ…ç¬¦å·
6. æ¯æ¬¡ç”Ÿæˆè¦æœ‰ä¸åŒçš„åˆ‡å…¥ç‚¹å’Œè¡¨è¾¾æ–¹å¼
7. å¯ä»¥ä»ä¸åŒè§’åº¦åˆ‡å…¥ï¼šæ•ˆæœã€æœåŠ¡ã€ç¯å¢ƒã€æ€§ä»·æ¯”ã€æŠ€æœ¯ç­‰`;
        
        const raw = await callChatCompletions({ 
          apiBase: DEEPSEEK_CONFIG.apiBase, 
          apiKey: DEEPSEEK_CONFIG.apiKey, 
          model: DEEPSEEK_CONFIG.model, 
          system, 
          user: userMsg, 
          temperature: 0.9,  // æé«˜æ¸©åº¦å¢åŠ éšæœºæ€§
          maxTokens: 500 
        });
        const text = cutToLength(raw, targetLength);
        result.style.display = "block";
        result.textContent = text;
        btnCopyGo.disabled = !text;
        const actualLength = text.replace(/\s+/g, "").length;
        status.textContent = text ? `âœ… å·²ç”ŸæˆçœŸå®è¯„ä»·ï¼Œå…±${actualLength}å­— | é£æ ¼ï¼š${randomStyle.split('ï¼š')[0]}` : "ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•";
      } catch (e) {
        status.textContent = "è¯·æ±‚å¤±è´¥ï¼š" + (e && e.message ? e.message : e);
      } finally {
        btnGen.disabled = false; btnGen.textContent = "ç”Ÿæˆæ–‡æ¡ˆ";
      }
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch (_) {}
      // æ—§æ–¹æ¡ˆå…œåº•
      const ta = document.createElement("textarea");
      ta.value = text; document.body.appendChild(ta);
      ta.select(); ta.setSelectionRange(0, 99999);
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }

    // è·³è½¬åˆ°åº—é“º
    function jumpToShop() {
      const platform = $("shopPlatform").value;
      const shopInfo = MEITUAN_SHOP_INFO;
      const shopDetails = `åº—é“ºåç§°ï¼š${shopInfo.name}\nåº—é“ºåœ°å€ï¼š${shopInfo.address}\nè”ç³»ç”µè¯ï¼š${shopInfo.phone}`;
      
      const deepLink = DEEP_LINKS[platform];
      const platformName = platform === "meituan" ? "ç¾å›¢" : "æŠ–éŸ³";
      
      console.log(`è·³è½¬åˆ°${platformName}åº—é“º`);
      status.textContent = `æ­£åœ¨è°ƒèµ·${platformName}APP...\n\n${shopDetails}\n\næ·±åº¦é“¾æ¥: ${deepLink}`;
      
      try {
        // ä½¿ç”¨iframeå°è¯•è°ƒèµ·APP
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = deepLink;
        document.body.appendChild(iframe);
        
        let appOpened = false;
        
        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆAPPæ‰“å¼€æ—¶é¡µé¢ä¼šå¤±å»ç„¦ç‚¹ï¼‰
        const handleVisibilityChange = () => {
          if (document.hidden) {
            appOpened = true;
            status.textContent = `âœ… æˆåŠŸï¼${platformName}APPå·²è°ƒèµ·ï¼\n\n${shopDetails}\n\næ·±åº¦é“¾æ¥: ${deepLink}\n\nè¯·æ£€æŸ¥æ˜¯å¦è·³è½¬åˆ°åº—é“ºä¸»é¡µ`;
            document.removeEventListener('visibilitychange', handleVisibilityChange);
          }
        };
        
        document.addEventListener('visibilitychange', handleVisibilityChange);
        
        // 3ç§’åæ£€æµ‹
            setTimeout(() => {
          if (iframe.parentNode) {
            document.body.removeChild(iframe);
          }
          document.removeEventListener('visibilitychange', handleVisibilityChange);
          
          if (!appOpened) {
            status.textContent = `âŒ è°ƒèµ·${platformName}APPå¤±è´¥\n\n${shopDetails}\n\næ·±åº¦é“¾æ¥: ${deepLink}\n\nè¯·ç¡®ä¿å·²å®‰è£…${platformName}APP`;
          }
        }, 3000);
        
      } catch (e) {
        console.log(`è°ƒèµ·${platformName}APPå¤±è´¥:`, e);
        status.textContent = `âŒ è°ƒèµ·${platformName}APPå¤±è´¥ï¼š${e.message}\n\n${shopDetails}`;
      }
    }
    
    // å¤åˆ¶å¹¶è·³è½¬
    async function copyAndJump() {
      const text = result.textContent.trim();
      if (!text) return;
      
      const ok = await copyText(text);
      const platform = $("shopPlatform").value;
      const platformName = platform === "meituan" ? "ç¾å›¢" : "æŠ–éŸ³";
      
      if (ok) {
        status.textContent = `æ–‡æ¡ˆå·²å¤åˆ¶ï¼Œæ­£åœ¨æ‰“å¼€${platformName}åº—é“ºâ€¦`;
        
        // è°ƒèµ·APPå¹¶è·³è½¬
        const deepLink = DEEP_LINKS[platform];
        
        try {
          // ä½¿ç”¨iframeå°è¯•è°ƒèµ·APP
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = deepLink;
          document.body.appendChild(iframe);
          
          setTimeout(() => {
            if (iframe.parentNode) {
              document.body.removeChild(iframe);
            }
            status.textContent = `æ–‡æ¡ˆå·²å¤åˆ¶ï¼Œ${platformName}APPå·²è°ƒèµ·ï¼\n\nè¯·åœ¨APPä¸­ç²˜è´´è¯„ä»·å†…å®¹`;
          }, 2000);
          
        } catch (e) {
          console.log('è°ƒèµ·APPå¤±è´¥:', e);
          status.textContent = `æ–‡æ¡ˆå·²å¤åˆ¶ï¼Œä½†è°ƒèµ·${platformName}APPå¤±è´¥\n\nè¯·æ‰‹åŠ¨æ‰“å¼€${platformName}APP`;
        }
      } else {
        status.textContent = "å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æ¡ˆ";
      }
    }
    
    // ç»‘å®šæŒ‰é’®äº‹ä»¶
    btnGen.addEventListener("click", generate);
    btnCopyGo.addEventListener("click", copyAndJump);
  </script>
  
</body>
</html>